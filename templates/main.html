{% extends "base.html" %}
{% load static %}

{% block title %}ShopEasy - The Best Deals Online{% endblock title %}

{% block content %}

    <!-- 1. Hero Section -->
    <section class="hero-section text-center py-5" style="background: url('https://placehold.co/1920x600/333/FFF?text=') no-repeat center center; background-size: cover; color: white;">
        <div class="container py-5">
            <h1 class="display-4 fw-bold">Welcome to ShopEasy</h1>
            <p class="lead col-lg-8 mx-auto">Your one-stop shop for everything you need. Quality products, unbeatable prices.</p>
            <a href="{% url 'product_list' %}" class="btn btn-primary btn-lg mt-3">Shop Now</a>
        </div>
    </section>

    <!-- 2. Featured Categories -->
    <section class="py-5">
        <div class="position-relative">
            <div class="carousel-viewport">
                <div class="d-flex flex-nowrap" id="categoryTrack">
                    {% for category in categories %}
                        <a href="{% url 'category' category.slug %}">
                            <div class="flex-shrink-0 me-3" style="min-width: 300px; max-width: 355px; height: 290px">
                                <div class="card h-100 text-center shadow-sm">
                                    {% if category.image %}
                                        <img src="{{ category.image.url }}" class="card-img-top"
                                             alt="{{ category.name }} Image"
                                             style="height: 200px; object-fit: cover;">
                                    {% else %}
                                        <img src="https://placehold.co/300x200/ccc/333?text=No+Image"
                                             class="card-img-top" alt="Category Image">
                                    {% endif %}
                                    <div class="card-body">
                                        <h5 class="card-title">{{ category.description }}</h5>
                                    </div>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>

            <button id="toggleAnimation" class="btn btn-light rounded-circle shadow position-absolute"
                    style="top: -50px; right: 0;" aria-label="Toggle Animation">
                <i class="bi bi-pause-fill fs-4" id="animationIcon"></i>
            </button>
        </div>
    </section>
    <!-- 3. Featured Products -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-4">Our Top Picks</h2>
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="card h-100 text-center shadow-sm">
                        <img src="https://placehold.co/300x300/fff/333?text=Product+1" class="card-img-top p-3" alt="Featured Product">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Sample Product 1</h5>
                            <p class="card-text fw-bold text-primary fs-5 mt-auto">€19.99</p>
                            <form method="post" action="#">
                                <button type="submit" class="btn btn-success w-100">Add to Cart</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card h-100 text-center shadow-sm">
                        <img src="https://placehold.co/300x300/fff/333?text=Product+2" class="card-img-top p-3" alt="Featured Product">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Sample Product 2</h5>
                            <p class="card-text fw-bold text-primary fs-5 mt-auto">€29.99</p>
                            <form method="post" action="#">
                                <button type="submit" class="btn btn-success w-100">Add to Cart</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card h-100 text-center shadow-sm">
                        <img src="https://placehold.co/300x300/fff/333?text=Product+3" class="card-img-top p-3" alt="Featured Product">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Sample Product 3</h5>
                            <p class="card-text fw-bold text-primary fs-5 mt-auto">€39.99</p>
                            <form method="post" action="#">
                                <button type="submit" class="btn btn-success w-100">Add to Cart</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card h-100 text-center shadow-sm">
                        <img src="https://placehold.co/300x300/fff/333?text=Product+4" class="card-img-top p-3" alt="Featured Product">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Sample Product 4</h5>
                            <p class="card-text fw-bold text-primary fs-5 mt-auto">€49.99</p>
                            <form method="post" action="#">
                                <button type="submit" class="btn btn-success w-100">Add to Cart</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. Newsletter Signup -->
    <section class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-7 text-center">
                    <h2>Stay Updated</h2>
                    <p class="lead">Subscribe to our newsletter for the latest deals and new arrivals.</p>
                    <form class="d-flex mt-4" method="post" action="#">
                        <input type="email" name="email" class="form-control form-control-lg me-2" placeholder="Enter your email" required>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. Customer Testimonials -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">What Our Customers Say</h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <blockquote class="blockquote mb-0">
                                <p>"Absolutely love the quality and the fast shipping! My new favorite online store."</p>
                                <footer class="blockquote-footer mt-2 d-flex align-items-center">
                                    <img src="https://placehold.co/50x50/343a40/ffffff?text=A" class="rounded-circle me-2" alt="Avatar">
                                    Anna Kendrick
                                </footer>
                            </blockquote>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <blockquote class="blockquote mb-0">
                                <p>"The customer service was incredibly helpful in resolving my issue. Highly recommended!"</p>
                                <footer class="blockquote-footer mt-2 d-flex align-items-center">
                                    <img src="https://placehold.co/50x50/343a40/ffffff?text=J" class="rounded-circle me-2" alt="Avatar">
                                    John Smith
                                </footer>
                            </blockquote>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 6. End-of-page CTA Banner -->
    <section class="py-4 bg-primary text-white text-center">
        <div class="container">
            <h4 class="m-0">Free shipping on all orders over €50!</h4>
        </div>
    </section>


    <style>
        a {
            text-decoration: none;
        }


        .carousel-viewport {
            overflow: hidden; /* FONDAMENTALE: nasconde tutto ciò che esce */
            padding-top: 17px; /* Spostiamo qui il padding che avevi prima */
        }

        #categoryTrack {
            /* Questo elemento verrà spostato da JavaScript.
               'will-change' è un'ottimizzazione per il browser. */
            will-change: transform;
        }

        a {
            text-decoration: none;
        }
        .card {
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
        }
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            z-index: 1;
        }
    </style>

{% endblock content %}

{% block footer_js %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const viewport = document.querySelector('.carousel-viewport');
            const track = document.getElementById('categoryTrack');

            if (!track || track.children.length === 0) return;

            const toggleBtn = document.getElementById('toggleAnimation');
            const icon = document.getElementById('animationIcon');

            // --- SETUP INIZIALE E CLONAZIONE ---
            const originalItems = Array.from(track.children);
            const viewportWidth = viewport.offsetWidth;
            let currentTrackWidth = track.scrollWidth;

            while (currentTrackWidth < viewportWidth * 2) {
                originalItems.forEach(item => {
                    track.appendChild(item.cloneNode(true));
                });
                currentTrackWidth = track.scrollWidth;
            }

            // --- VARIABILI DI STATO ---
            let isPaused = false;
            let isHovering = false;
            let isInteracting = false; // Nuovo: vero se l'utente sta scrollando
            let interactionTimeout;
            let animationFrameId;
            let currentPosition = 0;
            const speed = 0.5;
            const loopPoint = track.scrollWidth / (track.children.length / originalItems.length);

            // --- NUOVO: GESTIONE DELLO SCROLL MANUALE (TOUCHPAD/MOUSE) ---
            viewport.addEventListener('wheel', (event) => {
                // Previene lo scroll verticale della pagina mentre si scrolla orizzontalmente
                if (Math.abs(event.deltaX) > Math.abs(event.deltaY)) {
                    event.preventDefault();
                }

                isInteracting = true; // L'utente sta interagendo
                currentPosition -= event.deltaX; // Aggiorna la posizione con il valore dello scroll

                // Limita lo scroll per non creare spazi vuoti
                const maxScroll = track.scrollWidth - viewportWidth;
                if (currentPosition > 0) {
                    currentPosition = 0;
                }
                if (currentPosition < -maxScroll) {
                    currentPosition = -maxScroll;
                }
                track.style.transform = `translateX(${currentPosition}px)`;

                // Fa ripartire l'animazione dopo un breve periodo di inattività
                clearTimeout(interactionTimeout);
                interactionTimeout = setTimeout(() => {
                    isInteracting = false;
                }, 150); // 150ms di attesa
            });


            // --- FUNZIONE DI ANIMAZIONE ---
            const animate = () => {
                // L'animazione parte solo se non è in pausa e l'utente non sta interagendo
                if (!isPaused && !isHovering && !isInteracting) {
                    currentPosition -= speed;
                    if (Math.abs(currentPosition) >= loopPoint) {
                        currentPosition += loopPoint;
                    }
                    track.style.transform = `translateX(${currentPosition}px)`;
                }

                animationFrameId = requestAnimationFrame(animate);
            };

            // --- GESTORI DI EVENTI ESISTENTI ---
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    isPaused = !isPaused;
                    if (icon) {
                        icon.className = isPaused ? 'bi bi-play-fill fs-4' : 'bi bi-pause-fill fs-4';
                    }
                });
            }

            // Usiamo isInteracting anche per il mouse-hover per una logica più pulita
            viewport.addEventListener('mouseenter', () => { isHovering = true; });
            viewport.addEventListener('mouseleave', () => { isHovering = false; });

            // Avvia l'animazione
            animate();
        });
    </script>









{% endblock footer_js %}